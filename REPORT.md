# REPORT: ITMO Masters Advisor

## Цель
Система помогает абитуриентам понять, какая магистратура ИТМО им подходит: «Искусственный интеллект» (AI) или «AI Product», а также спланировать обучение по официальным учебным планам.

## Источники и приоритеты
- Источники истины: страницы программ на abit.itmo.ru и соответствующие PDF учебных планов.
- Вторичные («недоверенные до верификации»): ai.itmo.ru, страницы Альфа‑Банка и др. Используются только при подтверждении данными из планов.

## Архитектура
- **scraper/**: скачивание страниц, разрешение прямой ссылки «Скачать учебный план» (поиск по шаблону или fallback на прямые URL), загрузка PDF, извлечение таблиц (Camelot/Tabula/pdfplumber), нормализация полей (RU→EN), валидация pydantic, запись JSON + SQLite.
- **rag/**: построение гибридного индекса (Chroma+BM25), чанк — одна дисциплина. В каждом документе хранится `source_ref` (page,row) для цитирования.
- **recommender/**: эвристики подбора выборных по профилю/интересам с учётом семестра/ECTS.
- **bot/**: aiogram 3, команды, фильтр релевантности, краткие по делу ответы с цитатами.
- **api/**: FastAPI для локального тестирования RAG и рекомендателя.

## Решения по стеку
- Python 3.11+, httpx + BeautifulSoup/selectolax, Camelot/Tabula/pdfplumber для PDF, pandas/openpyxl для Excel (если появится).
- Хранилище: JSON + SQLite; индексы: Chroma (вектор) и BM25 (rank-bm25).
- Эмбеддинги: локально BAAI/bge-m3; опционально OpenAI text-embedding-3-small.
- Логи: стандартный logging; можно заменить на structlog.

## RAG и защита от галлюцинаций
- Классификатор релевантности: список ключевых токенов + порог по гибридному скору.
- Ответ формируется **только** из извлечённых фрагментов; в ответ всегда выводятся цитаты вида: «Программа X, pdf:page=Y,row=Z».
- При конфликте внешних источников с планами — игнор внешнего или пометка «нужно подтвердить по официальному плану».

## Диалоговый флоу (бот)
- Приветствие → выбор режима (/compare, /plan, /electives) → при необходимости сбор мини‑профиля.

## Ограничения/риски
- Формат PDF часто меняется → могут быть ложные разбиения столбцов; предусмотрены 3 движка парсинга.
- При недоступности API-ссылок потребуется обновление `DIRECT_PLAN_PDFS`.
- Для полной точности ECTS/правил следует дополнительно парсить разделы «Правила» в PDF, пока используется эвристика.

## Примеры диалогов
- Пользователь: «Сколько ECTS в семестре 1 на AI?»  
  Бот: «Вот что нашёл… ⮕ Цитата: AI, pdf:page=12,row=5»
- Пользователь: «Я хочу в продуктовую аналитику. Что выбрать?»  
  Бот: рекомендации primary/secondary/stretch с обоснованием и ссылками.

## Definition of Done (соответствие)
- Парсинг и нормализация двух учебных планов — `make scrape` создаёт `data/normalized/*.json`.
- Бот отвечает только по теме, умеет сравнивать и рекомендовать выборные.
- Ответы опираются на цитаты `source_ref` из планов.
- Публичная публикация: подготовлен README, проект готов к выкладке на GitHub. Для проверки приложен архив.
